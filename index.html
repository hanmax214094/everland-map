<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Everland Interactive Map - PoC</title>
    <link rel="stylesheet" href="./vendor/leaflet/leaflet.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <header class="app-header">
            <div class="title-block">
                <h1>Everland Interactive Map</h1>
                <p class="subtitle">å³æ™‚æ¢ç´¢åœ’å€ã€æœå°‹è¨­æ–½èˆ‡æŸ¥çœ‹ä½ç½®</p>
            </div>
            <button type="button" class="ghost-button" aria-label="å®šä½åˆ°æˆ‘çš„ä½ç½®" @click="handleLocate">
                <span aria-hidden="true">ğŸ“</span>
                æˆ‘çš„å®šä½
            </button>
        </header>
        <main class="container">
            <aside
                id="facility-list"
                class="facility-list"
                :class="{ open: isMobile && isListOpen }"
                aria-label="è¨­æ–½åˆ—è¡¨"
                :aria-hidden="(isMobile && !isListOpen).toString()"
            >
                <div id="list-controls">
                    <div class="drag-handle" role="button" tabindex="0" aria-label="é–‹å•Ÿæˆ–é—œé–‰è¨­æ–½åˆ—è¡¨"
                        @click="toggleList()"
                        @keydown.enter.prevent="toggleList()"
                        @keydown.space.prevent="toggleList()"
                    ></div>
                    <label class="sr-only" for="search-box">æœå°‹è¨­æ–½</label>
                    <div class="search-field">
                        <input
                            type="search"
                            id="search-box"
                            placeholder="æœå°‹è¨­æ–½æˆ–é—œéµå­—..."
                            autocomplete="off"
                            inputmode="search"
                            v-model.trim="searchTerm"
                            @focus="openListOnMobile()"
                        >
                    </div>
                    <div id="filter-buttons" role="group" aria-label="åˆ†å€ç¯©é¸">
                        <button
                            v-for="zone in filterZones"
                            :key="zone"
                            type="button"
                            :class="['filter-btn', zoneClassMap[zone] || '', { active: selectedZone === zone }]"
                            @click="selectZone(zone)"
                            @focus="openListOnMobile()"
                        >{{ zone }}</button>
                    </div>
                </div>
                <div id="list-content" role="list" @focusin="openListOnMobile()">
                    <template v-for="category in visibleCategories" :key="category.name">
                        <h3
                            class="category-header"
                            :class="[category.zoneClass, { collapsed: category.isCollapsed }]"
                            :data-category="category.name"
                            role="button"
                            tabindex="0"
                            :aria-expanded="(!category.isCollapsed).toString()"
                            @click="toggleCategory(category)"
                            @keydown.enter.prevent="toggleCategory(category)"
                            @keydown.space.prevent="toggleCategory(category)"
                        >{{ category.name }}</h3>
                        <ul
                            :data-category="category.name"
                            role="list"
                            :class="{ collapsed: category.isCollapsed }"
                            :aria-hidden="category.isCollapsed.toString()"
                        >
                            <li
                                v-for="facility in category.visibleFacilities"
                                :key="facility.id"
                                :class="[
                                    facility.zoneClass,
                                    {
                                        'has-menu': facility.hasMenu,
                                        'has-sublist': facility.locations.length > 1,
                                        expanded: facility.showSublist
                                    }
                                ]"
                                role="listitem"
                                tabindex="0"
                                :data-name="facility.name"
                                @click="handleFacilityClick(facility)"
                                @keydown.enter.prevent="handleFacilityKey(facility)"
                                @keydown.space.prevent="handleFacilityKey(facility)"
                            >
                                <div class="facility-item-row">
                                    <button
                                        v-if="facility.hasMenu"
                                        type="button"
                                        class="menu-trigger"
                                        :aria-label="`æŸ¥çœ‹${facility.name}èœå–®`"
                                        title="æŸ¥çœ‹èœå–®"
                                        @click.stop="openMenu(facility)"
                                    >
                                        <span class="sr-only">æŸ¥çœ‹èœå–®</span>
                                    </button>
                                    <span class="facility-item-name">{{ facility.name }}</span>
                                </div>
                                <template v-if="facility.locations.length > 1">
                                    <ul
                                        class="sub-list"
                                        :class="{ collapsed: !facility.showSublist }"
                                        role="list"
                                        :aria-hidden="(!facility.showSublist).toString()"
                                    >
                                        <li
                                            v-for="(location, index) in facility.visibleLocations"
                                            :key="location.id"
                                            :data-lat="location.lat"
                                            :data-lng="location.lng"
                                            :data-parent-name="facility.name"
                                            role="listitem"
                                            tabindex="0"
                                            @click.stop="focusLocation(facility, location)"
                                            @keydown.enter.prevent="focusLocation(facility, location)"
                                            @keydown.space.prevent="focusLocation(facility, location)"
                                        >{{ location.label }}</li>
                                    </ul>
                                </template>
                            </li>
                        </ul>
                    </template>
                    <p v-if="visibleCategories.length === 0" class="empty-result">ç„¡æ³•æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„è¨­æ–½ã€‚</p>
                </div>
            </aside>
            <section id="map-container" class="map-container" aria-label="äº’å‹•åœ°åœ–">
                <div id="map" ref="mapElement"></div>
            </section>
        </main>

        <button
            type="button"
            id="mobile-list-toggle"
            v-if="isMobile"
            :aria-expanded="isListOpen.toString()"
            :aria-label="isListOpen ? 'é—œé–‰è¨­æ–½åˆ—è¡¨' : 'å±•é–‹è¨­æ–½åˆ—è¡¨'"
            @click="toggleList()"
            @keydown.esc.prevent="closeList()"
        >{{ isListOpen ? 'Ã—' : 'â‰¡' }}</button>
        <div class="mobile-backdrop" :class="{ visible: isMobile && isListOpen }" @click="closeList()"></div>

        <div
            id="menu-modal"
            class="menu-modal"
            :class="{ visible: menuModalVisible }"
            :aria-hidden="(!menuModalVisible).toString()"
            ref="menuModalRef"
            @click.self="closeMenu()"
        >
            <div class="menu-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="menu-modal-title">
                <button type="button" class="menu-modal__close" aria-label="é—œé–‰èœå–®è¦–çª—" @click="closeMenu" ref="menuCloseRef">&times;</button>
                <div class="menu-modal__header">
                    <p class="menu-modal__subtitle">é¤é»èœå–®</p>
                    <h2 id="menu-modal-title" class="menu-modal__title">{{ activeMenuFacility?.name || '' }}</h2>
                </div>
                <div class="menu-modal__body" ref="menuBodyRef">
                    <div class="menu-modal__list" role="list">
                        <article
                            v-for="menuItem in activeMenuFacility?.menuList || []"
                            :key="menuItem.id"
                            class="menu-card"
                            role="listitem"
                        >
                            <img
                                v-if="menuItem.menuImagUrl"
                                class="menu-card__image"
                                :src="menuItem.menuImagUrl"
                                :alt="`${formatMenuName(menuItem)} åœ–ç‰‡`"
                                loading="lazy"
                            >
                            <div class="menu-card__content">
                                <h4 class="menu-card__title">{{ formatMenuName(menuItem) }}</h4>
                                <p v-if="formatMenuSubtitle(menuItem)" class="menu-card__subtitle">{{ formatMenuSubtitle(menuItem) }}</p>
                                <p v-if="formatMenuPrice(menuItem.menuPrice)" class="menu-card__price">åƒ¹æ ¼ï¼š{{ formatMenuPrice(menuItem.menuPrice) }}</p>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="./vendor/leaflet/leaflet.js"></script>
    <script src="script.js"></script>
</body>
</html>
